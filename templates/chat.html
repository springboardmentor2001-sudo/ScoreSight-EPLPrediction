{% extends "base.html" %}
{% block title %}AI Football Chat | EPL Predictor{% endblock %}

{% block content %}
<div class="container mt-5 d-flex justify-content-center">
    <div class="chat-box shadow-lg">
        <div class="messages" id="messages"></div>
        <div class="input-area">
            <input id="user-input" type="text" placeholder="Type your message..." />
            <button onclick="sendMessage()">Send</button>
        </div>
    </div>
</div>

<style>
    .chat-box {
        width: 90%;
        max-width: 850px; /* Wider for laptop */
        height: 75vh;
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(12px);
        border-radius: 20px;
        box-shadow: 0 4px 25px rgba(0,0,0,0.3);
        display: flex;
        flex-direction: column;
        overflow: hidden;
        border: 1px solid rgba(255, 255, 255, 0.2);
        margin-bottom: 30px;
    }

    .messages {
        flex: 1;
        padding: 20px;
        overflow-y: auto;
        display: flex;
        flex-direction: column;
        gap: 12px;
    }

    .message {
        padding: 12px 16px;
        border-radius: 16px;
        max-width: 70%;
        word-wrap: break-word;
        display: inline-block;
        font-size: 15px;
        animation: fadeIn 0.25s ease-in;
    }

    .user {
        background: #007bff;
        color: white;
        align-self: flex-end; /* Right side */
        border-bottom-right-radius: 4px;
    }

    .bot {
        background: rgba(255,255,255,0.9);
        color: #000;
        align-self: flex-start; /* Left side */
        border-bottom-left-radius: 4px;
    }

    .input-area {
        display: flex;
        border-top: 1px solid rgba(255,255,255,0.3);
        background: rgba(255,255,255,0.1);
    }

    .input-area input {
        flex: 1;
        border: none;
        padding: 16px;
        font-size: 16px;
        background: transparent;
        color: white;
        outline: none;
    }

    .input-area input::placeholder {
        color: rgba(255,255,255,0.7);
    }

    .input-area button {
        background: #5a189a;
        color: white;
        border: none;
        padding: 0 24px;
        cursor: pointer;
        font-weight: bold;
        transition: background 0.3s ease;
    }

    .input-area button:hover {
        background: #9d4edd;
    }

    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(5px); }
        to { opacity: 1; transform: translateY(0); }
    }

    /* üì± Responsive design for mobile */
    @media (max-width: 768px) {
        .chat-box {
            width: 95%;
            height: 80vh;
        }

        .message {
            max-width: 85%;
            font-size: 14px;
        }

        .input-area input {
            padding: 14px;
            font-size: 15px;
        }

        .input-area button {
            padding: 0 18px;
        }
    }

    @media (max-width: 480px) {
        .chat-box {
            height: 85vh;
            border-radius: 12px;
        }

        .message {
            max-width: 90%;
        }
    }
</style>

<script>
    async function sendMessage() {
        const inputField = document.getElementById("user-input");
        const message = inputField.value.trim();
        if (!message) return;

        const messagesDiv = document.getElementById("messages");
        messagesDiv.innerHTML += `<div class='message user'>${message}</div>`;
        inputField.value = "";

        // Optional: Typing indicator
        const typingDiv = document.createElement("div");
        typingDiv.className = "message bot";
        typingDiv.textContent = "Typing...";
        messagesDiv.appendChild(typingDiv);
        messagesDiv.scrollTop = messagesDiv.scrollHeight;

        try {
            const response = await fetch("/get_response", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ message })
            });

            const data = await response.json();
            typingDiv.remove(); // Remove "Typing..." bubble
            messagesDiv.innerHTML += `<div class='message bot'>${data.response}</div>`;
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        } catch (err) {
            console.error("Fetch failed:", err);
            typingDiv.remove();
            messagesDiv.innerHTML += `<div class='message bot'>‚ö†Ô∏è Error connecting to server</div>`;
        }
    }

    // Press Enter to send
    document.getElementById("user-input").addEventListener("keypress", function(e) {
        if (e.key === "Enter") sendMessage();
    });
</script>

{% endblock %}
